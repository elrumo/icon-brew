import axios from"axios";import algoliasearch from"algoliasearch";const client=algoliasearch(process.env.ALGOLIA_APP_ID,process.env.ALGOLIA_SEARCH_KEY),index=client.initIndex(process.env.ALGOLIA_INDEX);import{getIconsFromStrapi,getCategoriesFromStrapi,getHomeData,getSinglePage,getSuggestionsHero,getSuggestions}from"@/api/strapi";export const state=()=>({icons:[],iconCategories:[],totalNoOfIcons:0,iconSize:"iconImage24px",downloadAs:"downloadSVG",homeData:{title:"IconBrew",subtitle:"A free and open source icon pack. With 280+ icons and new ones being added weekly.",createdAt:"2022-03-13T15:52:01.596Z",updatedAt:"2022-07-16T20:12:28.849Z",publishedAt:"2022-03-13T15:52:02.867Z",button:"Download all",buttonUrl:"https://www.figma.com/community/file/1121752926262800605",secondaryButton:"Donate",secondaryButtonUrl:"https://www.paypal.com/donate/?hosted_button_id=SLDP6A7FLN6S6",image:{data:{id:47,attributes:{name:"IconBrew-large.png",alternativeText:"IconBrew-large.png",caption:"IconBrew-large.png",width:1024,height:1024,formats:{large:{ext:".png",url:"/uploads/large_Icon_Brew_large_e7890b6e4f.png",hash:"large_Icon_Brew_large_e7890b6e4f",mime:"image/png",name:"large_IconBrew-large.png",path:null,size:846.09,width:1e3,height:1e3},small:{ext:".png",url:"/uploads/small_Icon_Brew_large_e7890b6e4f.png",hash:"small_Icon_Brew_large_e7890b6e4f",mime:"image/png",name:"small_IconBrew-large.png",path:null,size:239.08,width:500,height:500},medium:{ext:".png",url:"/uploads/medium_Icon_Brew_large_e7890b6e4f.png",hash:"medium_Icon_Brew_large_e7890b6e4f",mime:"image/png",name:"medium_IconBrew-large.png",path:null,size:515.29,width:750,height:750},thumbnail:{ext:".png",url:"/uploads/thumbnail_Icon_Brew_large_e7890b6e4f.png",hash:"thumbnail_Icon_Brew_large_e7890b6e4f",mime:"image/png",name:"thumbnail_IconBrew-large.png",path:null,size:32.27,width:156,height:156}},hash:"Icon_Brew_large_e7890b6e4f",ext:".png",mime:"image/png",size:168.11,url:"/uploads/Icon_Brew_large_e7890b6e4f.png",previewUrl:null,provider:"local",provider_metadata:null,createdAt:"2022-03-13T15:52:45.146Z",updatedAt:"2022-03-13T15:52:45.146Z"}}}},suggestionsHero:{title:"Missing an icon?",subtitle:"Is there an icon youâ€™d like to see on the site? Suggest it, or if somoene already has, upvote it!.",createdAt:"2022-03-13T15:52:01.596Z",updatedAt:"2022-07-16T20:12:28.849Z",publishedAt:"2022-03-13T15:52:02.867Z",button:"Suggest an icon",buttonUrl:"https://www.figma.com/community/file/1121752926262800605",primaryButtonIcon:"pi-download",primaryButtonIsOutline:!1,secondaryButton:"",secondaryButtonUrl:"",secondaryButtonIcon:"",secondaryButtonIsOutline:!0,image:{data:{id:47,attributes:{name:"IconBrew-large.png",alternativeText:"IconBrew-large.png",caption:"IconBrew-large.png",width:1024,height:1024,formats:{large:{ext:".png",url:"/uploads/large_Icon_Brew_large_e7890b6e4f.png",hash:"large_Icon_Brew_large_e7890b6e4f",mime:"image/png",name:"large_IconBrew-large.png",path:null,size:846.09,width:1e3,height:1e3},small:{ext:".png",url:"/uploads/small_Icon_Brew_large_e7890b6e4f.png",hash:"small_Icon_Brew_large_e7890b6e4f",mime:"image/png",name:"small_IconBrew-large.png",path:null,size:239.08,width:500,height:500},medium:{ext:".png",url:"/uploads/medium_Icon_Brew_large_e7890b6e4f.png",hash:"medium_Icon_Brew_large_e7890b6e4f",mime:"image/png",name:"medium_IconBrew-large.png",path:null,size:515.29,width:750,height:750},thumbnail:{ext:".png",url:"/uploads/thumbnail_Icon_Brew_large_e7890b6e4f.png",hash:"thumbnail_Icon_Brew_large_e7890b6e4f",mime:"image/png",name:"thumbnail_IconBrew-large.png",path:null,size:32.27,width:156,height:156}},hash:"Icon_Brew_large_e7890b6e4f",ext:".png",mime:"image/png",size:168.11,url:"/uploads/Icon_Brew_large_e7890b6e4f.png",previewUrl:null,provider:"local",provider_metadata:null,createdAt:"2022-03-13T15:52:45.146Z",updatedAt:"2022-03-13T15:52:45.146Z"}}}},suggestions:{},selectedCategory:"All Icons",searchValue:"",hitsPerPage:40,algoliaPage:0,searchFilters:"",isFetchingData:!1,previousQuery:[],singlePageData:"",aboutPageData:"",selectedIcon:{},iconSuggestionForm:{isValid:!1,formData:{}},suggestedIconName:"",suggestedIconCategory:"",suggestedIconUserName:"",suggestedIconEmail:"",suggestedIconNotes:"",iconWeight:2,iconColour:"#FFFFFF",bgColour:"#1F262F"});export const mutations={mutateFormData(e,t){e.iconSuggestionForm=t.data},setDataToState(e,t){e[t.state]=t.data},addDataToState(e,t){t.data.forEach(a=>{e[t.state].push(a)})}};export const actions={setDataToStore(e,t){e.commit("setDataToState",{state:t.state,data:t.data})},setIcons(e,t){e.commit("setDataToState",{state:"icons",data:t})},clearIcons(e,t){e.commit("setDataToState",{state:"icons",data:[]})},addIcons(e,t){e.commit("addDataToState",{state:"icons",data:t})},addOneToPage(e){let t=e.state.algoliaPage;e.commit("setDataToState",{state:"algoliaPage",data:t+1})},async fetchIcons(e){let t=await getIconsFromStrapi();try{e.commit("setDataToState",{arr:"icons",data:t})}catch(e){console.log("Error fetching learning resources: ",e)}},async fetchHomeData(e){try{let t=await getHomeData();e.commit("setDataToState",{state:"homeData",data:t})}catch(e){console.log("Error fetching learning resources: ",e)}},async fetchSuggestions(e){try{let t=await getSuggestions();e.commit("setDataToState",{state:"suggestions",data:t})}catch(e){console.log("Error fetching getSuggestions: ",e)}},async fetchSuggestionsHero(e){try{let t=await getSuggestionsHero();e.commit("setDataToState",{state:"suggestionsHero",data:t})}catch(e){console.log("Error fetching suggestionsHero: ",e)}},async fetchSinglePage(e,t){let a=await getSinglePage(t.id);console.log(t.state);try{e.commit("setDataToState",{state:t.state,data:a})}catch(e){console.log("Error fetching learning resources: ",e)}},async setCategory(e,t){let a=t.category,o="categories.categoryName:"+a,s=e.state.selectedCategory;if(a===s)return;"All Icons"==a?(o="",e.dispatch("setDataToState",{state:"hitsPerPage",data:40})):e.dispatch("setDataToState",{state:"hitsPerPage",data:500});let n=[{state:"selectedCategory",data:a},{state:"searchFilters",data:o},{state:"searchFilters",data:o},{state:"algoliaPage",data:0}];n.forEach(t=>{e.dispatch("setDataToState",{state:t.state,data:t.data})}),e.dispatch("searchAlgolia",{appendIcons:!1}),e.dispatch("scrollTo",460)},async searchAlgolia(e,t){e.dispatch("setDataToState",{state:"isFetchingData",data:!0});let a=t.appendIcons,o=e.state.searchValue,s=e.state.searchFilters,n=e.state.hitsPerPage,i=e.state.algoliaPage,r=e.state.selectedCategory,l=e.state.iconCategories,c=e.state.totalNoOfIcons;"All Icons"!=r&&(c=l.filter(e=>e.categoryName===r)[0].noOfIcons);const g=await index.search(o,{filters:s,page:i,hitsPerPage:n,attributesToRetrieve:["iconName","iconImage18px","iconImage24px","objectID","downloads"],attributesToHighlight:null});e.dispatch("setDataToState",{state:"isFetchingData",data:!1}),e.dispatch("setDataToState",{state:"previousQuery",data:g.hits}),a&&e.dispatch("addIcons",g.hits),a||e.dispatch("setIcons",g.hits)},async fetchTotalNoOfRecods(e){const t=await index.search("",{hitsPerPage:0,attributesToRetrieve:null,attributesToHighlight:null,analytics:!1});this.totalNoOfIcons=t.nbHits,e.dispatch("setDataToState",{state:"totalNoOfIcons",data:this.totalNoOfIcons})},async fetchIconCategories(e){let t=await getCategoriesFromStrapi();try{e.commit("setDataToState",{state:"iconCategories",data:t})}catch(e){console.log("Error fetching icon categories: ",e)}},setDataToState(e,t){e.commit("setDataToState",{state:t.state,data:t.data})},async addSuggestion(e,t){let a=e.state.suggestedIconName+"/",o=e.state.suggestedIconUserName+"/",s=e.state.suggestedIconEmail+"/",n=0==e.state.suggestedIconNotes.length?"-/":e.state.suggestedIconNotes+"/",i=e.state.suggestedIconCategory.code;try{let e="https://api.macosicons.com/api/icon-suggestions/create-suggestion/"+a+n+o+s+i;console.log("postUrl: ",e),await axios.post(e),await axios.post("https://api.macosicons.com/api/email/elrumo97@me.com/1/elias")}catch(e){console.log("Error adding suggestion: ",e)}},async addVote(e,t){let a,o=e.state.suggestions,s=o.filter(e=>e.id===t.id)[0],n=o.indexOf(s);a="add"===t.operation?o[n].attributes.votes+1:o[n].attributes.votes-1,localStorage.setItem("iconVoted-"+t.id,JSON.stringify({id:t.id,vote:t.localStorage})),await axios.get("https://api.macosicons.com/api/icon-suggestions/"+t.operation+"-vote-count/"+t.id);let i=JSON.parse(JSON.stringify(o));i[n].attributes.votes=a,e.commit("setDataToState",{state:"suggestions",data:i})},scrollTo(e,t){if("number"==typeof t)window.scrollTo(0,t-80);else if("object"==typeof t){let e=t.getBoundingClientRect().y;window.scrollTo(0,e-50)}},setSearchValue(e,t){console.log("setSearchValue",t)},downloadImage(e,t){const a=e.state.iconSize;let o="iconImage18px"==a?t.url.iconImage18px:t.url.iconImage24px,s=t.name+e.state.iconSize+".svg";switch(console.log(o),e.state.downloadAs){case"downloadSVG":fetch(o).then(e=>e.blob()).then(e=>{const a=window.URL.createObjectURL(e),o=document.createElement("a");o.style.display="none",o.href=a,o.download=s,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(a),console.log(t.id),axios.get("https://api.macosicons.com/api/icon-brews/add-download-count/"+t.id)}).catch(()=>alert("An error sorry"));break;case"copySVG":let a=document.getElementById(t.name);navigator.clipboard.writeText(a.outerHTML);let n=t.name.replaceAll("-"," ");n=n.replace(/^\w/,e=>e.toUpperCase()),this._vm.$toast.add({severity:"success",summary:n,detail:"copied as SVG",group:"iconDownload",life:3e3})}},setIconSuggestionForm(e,t){e.commit("setDataToState",{state:t.state,data:t.data})},getState:(e,t)=>e.state[t.state]};